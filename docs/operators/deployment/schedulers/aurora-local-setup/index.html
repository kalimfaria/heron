<!DOCTYPE html><html lang="en-us"><head><link rel="shortcut icon" type="image/png" sizes="16x16" href="https://twitter.github.io/heron/img/favicon-16x16.png"><link rel="shortcut icon" type="image/png" sizes="32x32" href="https://twitter.github.io/heron/img/favicon-32x32.png"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="generator" content="Hugo 0.29" /><meta property="og:locale" content="en_US"><meta property="og:type" content="article"><meta property="og:title" content="Heron"><meta property="og:image" content="/img/logo54x54.png"><meta property="og:url" content="https://twitter.github.io/heron"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@heronstreaming"><meta name="twitter:title" content="Heron"><meta name="twitter:image" content="/img/HeronTextLogo.png"><meta property="og:site_name" content="Setting up Heron with Aurora Cluster Locally on Linux"><meta property="og:url" content="/docs/operators/deployment/schedulers/aurora-local-setup/"><meta property="og:description" content=""><meta name="twitter:description" content=""><title>Heron Documentation - Setting up Heron with Aurora Cluster Locally on Linux</title><link rel="stylesheet" href="https://twitter.github.io/heron/css/font-awesome.min.css"><link rel="stylesheet" href="https://twitter.github.io/heron/css/style.css"><script type="text/javascript">
var shiftWindow = function() { scrollBy(0, -100) };
window.addEventListener("hashchange", shiftWindow);
function load() { if (window.location.hash) shiftWindow(); }
</script></head><body class="body"><main class="main"><nav class="hn-top-navbar navbar navbar-inverse navbar-fixed-top" role="navigation"><div class="hn-navbar-container container-fluid"><div class="navbar-header"><button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#hn-navbar" aria-controls="hn-navbar" aria-expanded="false"><span class="sr-only"><Toggle>navigation</Toggle></span><i class="hn-toggle-button fa fa-bars"></i></button><a class="hn-navbar-logo navbar-brand" href="https://twitter.github.io/heron/"><img class="pull-left" src="https://twitter.github.io/heron/img/HeronTextLogo-small.png"></a></div><div id="hn-navbar" class="navbar-collapse collapse"><ul class="nav navbar-nav navbar-right"><li><a href="https://twitter.github.io/heron/docs/getting-started">Docs</a></li><li><a href="https://twitter.github.io/heron/docs/resources">Resources</a></li><li><a href="https://twitter.github.io/heron/docs/contributors/community">Community</a></li><li><a href="https://github.com/twitter/heron">GitHub</a></li><li><a href="https://groups.google.com/forum/#!forum/heron-users">Mailing List</a></li><li><a class="nav-icon" href="https://twitter.com/heronstreaming"><i class="fa fa-twitter"></i></a></li></ul></div></div></nav><div class="hn-main"><div class="container"><div class="row"><aside class="hn-sidebar hidden-xs hidden-sm col-md-4 col-lg-2"><nav class="hn-sidebar-nav"><div id="hn-accordion" class="panel-group" role="tablist" aria-multiselectable="true"><div class="panel panel-default"><section id="getting-started" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-getting-started" aria-labelledby="getting-started"><i class="fa fa-caret-right"></i>Getting Started</a></h4></section><div id="collapse-getting-started" class="panel-collapse collapse" aria-labelledby="getting-started"><div class="panel-body"><ul><li><a href="https://twitter.github.io/heron/docs/getting-started">Local (Single Node)</a></li><li><a href="https://twitter.github.io/heron/docs/migrate-storm-to-heron">Migrate Storm Topologies</a></li><li><a href="https://twitter.github.io/heron/docs/getting-started-troubleshooting">Troubleshooting Guide</a></li></ul></div></div></div><div class="panel panel-default"><section id="the-heron-streamlet-api" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-the-heron-streamlet-api" aria-labelledby="the-heron-streamlet-api"><i class="fa fa-caret-right"></i>The Heron Streamlet API</a></h4></section><div id="collapse-the-heron-streamlet-api" class="panel-collapse collapse" aria-labelledby="the-heron-streamlet-api"><div class="panel-body"><ul><li><a href="https://twitter.github.io/heron/docs/developers/java/streamlet-api">The Heron Streamlet API for Java</a></li></ul></div></div></div><div class="panel panel-default"><section id="the-heron-topology-api" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-the-heron-topology-api" aria-labelledby="the-heron-topology-api"><i class="fa fa-caret-right"></i>The Heron Topology API</a></h4></section><div id="collapse-the-heron-topology-api" class="panel-collapse collapse" aria-labelledby="the-heron-topology-api"><div class="panel-body"><ul><li><a href="https://twitter.github.io/heron/docs/developers/java/topologies">The Heron Topology API for Java</a></li><li><a href="https://twitter.github.io/heron/docs/developers/java/effectively-once">Effectively-once Java topologies</a></li><li><a href="https://twitter.github.io/heron/docs/developers/python/topologies">Python Topologies</a></li><li><a href="https://twitter.github.io/heron/docs/developers/data-model">Heron Data Model</a></li><li><a href="https://twitter.github.io/heron/docs/developers/serialization">Tuple Serialization</a></li><li><a href="https://twitter.github.io/heron/docs/developers/ui-guide">Heron UI Guide</a></li><li><a href="https://twitter.github.io/heron/docs/developers/tuning">Tuning Guide</a></li><li><a href="https://twitter.github.io/heron/docs/developers/packing/ffdpacking">Packing Algorithms</a></li><li><a href="https://twitter.github.io/heron/docs/developers/simulator-mode">Simulator Mode</a></li><li><a href="https://twitter.github.io/heron/docs/developers/troubleshooting">Troubleshooting Guide</a></li></ul></div></div></div><div class="panel panel-default"><section id="client-api-docs" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-client-api-docs" aria-labelledby="client-api-docs"><i class="fa fa-caret-right"></i>Client API docs</a></h4></section><div id="collapse-client-api-docs" class="panel-collapse collapse" aria-labelledby="client-api-docs"><div class="panel-body"><ul><li><a href="https://twitter.github.io/heron/api/java">Java</a></li><li><a href="https://twitter.github.io/heron/api/python">Python</a></li></ul></div></div></div><div class="panel panel-default"><section id="heron-concepts" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-heron-concepts" aria-labelledby="heron-concepts"><i class="fa fa-caret-right"></i>Heron Concepts</a></h4></section><div id="collapse-heron-concepts" class="panel-collapse collapse" aria-labelledby="heron-concepts"><div class="panel-body"><ul><li><a href="https://twitter.github.io/heron/docs/concepts/design-goals">Heron Design Goals</a></li><li><a href="https://twitter.github.io/heron/docs/concepts/topologies">Heron Topologies</a></li><li><a href="https://twitter.github.io/heron/docs/concepts/architecture">Heron Architecture</a></li><li><a href="https://twitter.github.io/heron/docs/concepts/delivery-semantics">Heron Delivery Semantics</a></li></ul></div></div></div><div class="panel panel-default"><section id="deployment" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-deployment" aria-labelledby="deployment"><i class="fa fa-caret-right"></i>Deployment</a></h4></section><div id="collapse-deployment" class="panel-collapse collapse" aria-labelledby="deployment"><div class="panel-body"><ul><li><a href="https://twitter.github.io/heron/docs/operators/deployment">Overview</a></li><li><a href="https://twitter.github.io/heron/docs/operators/deployment/configuration">Configuration</a></li><li><a href="https://twitter.github.io/heron/docs/operators/heron-api-server">The Heron API server</a></li></ul></div></div></div><div class="panel panel-default"><section id="state-managers" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-state-managers" aria-labelledby="state-managers"><i class="fa fa-caret-right"></i>State Managers</a></h4></section><div id="collapse-state-managers" class="panel-collapse collapse" aria-labelledby="state-managers"><div class="panel-body"><ul><li><a href="https://twitter.github.io/heron/docs/operators/deployment/statemanagers/zookeeper">Zookeeper</a></li><li><a href="https://twitter.github.io/heron/docs/operators/deployment/statemanagers/localfs">Local FS</a></li></ul></div></div></div><div class="panel panel-default"><section id="uploaders" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-uploaders" aria-labelledby="uploaders"><i class="fa fa-caret-right"></i>Uploaders</a></h4></section><div id="collapse-uploaders" class="panel-collapse collapse" aria-labelledby="uploaders"><div class="panel-body"><ul><li><a href="https://twitter.github.io/heron/docs/operators/deployment/uploaders/localfs">Local FS</a></li><li><a href="https://twitter.github.io/heron/docs/operators/deployment/uploaders/hdfs">HDFS</a></li><li><a href="https://twitter.github.io/heron/docs/operators/deployment/uploaders/s3">Amazon S3</a></li><li><a href="https://twitter.github.io/heron/docs/operators/deployment/uploaders/scp">Secure Copy (SCP)</a></li></ul></div></div></div><div class="panel panel-default"><section id="schedulers" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-schedulers" aria-labelledby="schedulers"><i class="fa fa-caret-right"></i>Schedulers</a></h4></section><div id="collapse-schedulers" class="panel-collapse collapse" aria-labelledby="schedulers"><div class="panel-body"><ul><li><a href="https://twitter.github.io/heron/docs/operators/deployment/schedulers/kubernetes">Kubernetes</a></li><li><a href="https://twitter.github.io/heron/docs/operators/deployment/schedulers/aurora">Aurora Cluster</a></li><li><a href="https://twitter.github.io/heron/docs/operators/deployment/schedulers/local">Local Cluster</a></li><li><a href="https://twitter.github.io/heron/docs/operators/deployment/schedulers/mesos-local-mac">Mesos Cluster Locally</a></li><li><a href="https://twitter.github.io/heron/docs/operators/deployment/schedulers/slurm">Slurm Cluster</a></li><li><a href="https://twitter.github.io/heron/docs/operators/deployment/schedulers/yarn">YARN Cluster</a></li></ul></div></div></div><div class="panel panel-default"><section id="cluster-configuration" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-cluster-configuration" aria-labelledby="cluster-configuration"><i class="fa fa-caret-right"></i>Cluster Configuration</a></h4></section><div id="collapse-cluster-configuration" class="panel-collapse collapse" aria-labelledby="cluster-configuration"><div class="panel-body"><ul><li><a href="https://twitter.github.io/heron/docs/operators/configuration/config-intro">Overview</a></li><li><a href="https://twitter.github.io/heron/docs/operators/configuration/system">System-Level</a></li><li><a href="https://twitter.github.io/heron/docs/operators/configuration/instance">Heron Instance</a></li><li><a href="https://twitter.github.io/heron/docs/operators/configuration/metrics-manager">Metrics Manager</a></li><li><a href="https://twitter.github.io/heron/docs/operators/configuration/stmgr">Stream Manager</a></li><li><a href="https://twitter.github.io/heron/docs/operators/configuration/tmaster">Topology Master</a></li></ul></div></div></div><div class="panel panel-default"><section id="observability" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-observability" aria-labelledby="observability"><i class="fa fa-caret-right"></i>Observability</a></h4></section><div id="collapse-observability" class="panel-collapse collapse" aria-labelledby="observability"><div class="panel-body"><ul><li><a href="https://twitter.github.io/heron/docs/operators/observability/prometheus">Prometheus</a></li><li><a href="https://twitter.github.io/heron/docs/operators/observability/graphite">Graphite</a></li><li><a href="https://twitter.github.io/heron/docs/operators/observability/scribe">Scribe</a></li></ul></div></div></div><div class="panel panel-default"><section id="user-manuals" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-user-manuals" aria-labelledby="user-manuals"><i class="fa fa-caret-right"></i>User Manuals</a></h4></section><div id="collapse-user-manuals" class="panel-collapse collapse" aria-labelledby="user-manuals"><div class="panel-body"><ul><li><a href="https://twitter.github.io/heron/docs/operators/heron-cli">Heron Client</a></li><li><a href="https://twitter.github.io/heron/docs/operators/heron-explorer">Heron Explorer</a></li><li><a href="https://twitter.github.io/heron/docs/operators/heron-tracker-api">Heron Tracker REST API</a></li><li><a href="https://twitter.github.io/heron/docs/operators/heron-tracker">Heron Tracker Runbook</a></li><li><a href="https://twitter.github.io/heron/docs/operators/heron-ui">Heron UI Runbook</a></li></ul></div></div></div><div class="panel panel-default"><section id="heron-developers" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-heron-developers" aria-labelledby="heron-developers"><i class="fa fa-caret-right"></i>Heron Developers</a></h4></section><div id="collapse-heron-developers" class="panel-collapse collapse" aria-labelledby="heron-developers"><div class="panel-body"><ul><li><a href="https://twitter.github.io/heron/docs/developers/compiling/compiling">Compiling</a></li><li><a href="https://twitter.github.io/heron/docs/developers/compiling/linux">Compiling on Linux</a></li><li><a href="https://twitter.github.io/heron/docs/developers/compiling/mac">Compiling on Mac OS X</a></li><li><a href="https://twitter.github.io/heron/docs/developers/compiling/docker">Compiling With Docker</a></li><li><a href="https://twitter.github.io/heron/docs/contributors/testing">Running Tests</a></li><li><a href="https://twitter.github.io/heron/docs/contributors/codebase">Code Organization</a></li></ul></div></div></div><div class="panel panel-default"><section id="extending-heron" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-extending-heron" aria-labelledby="extending-heron"><i class="fa fa-caret-right"></i>Extending Heron</a></h4></section><div id="collapse-extending-heron" class="panel-collapse collapse" aria-labelledby="extending-heron"><div class="panel-body"><ul><li><a href="https://twitter.github.io/heron/docs/contributors/custom-scheduler">Custom Scheduler</a></li><li><a href="https://twitter.github.io/heron/docs/contributors/custom-metrics-sink">Custom Metrics Sink</a></li></ul></div></div></div><div class="panel panel-default"><section id="heron-resources" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-heron-resources" aria-labelledby="heron-resources"><i class="fa fa-caret-right"></i>Heron Resources</a></h4></section><div id="collapse-heron-resources" class="panel-collapse collapse" aria-labelledby="heron-resources"><div class="panel-body"><ul><li><a href="https://twitter.github.io/heron/docs/resources">Heron Resources</a></li></ul></div></div></div><div class="panel panel-default"><section id="contributors" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-contributors" aria-labelledby="contributors"><i class="fa fa-caret-right"></i>Contributors</a></h4></section><div id="collapse-contributors" class="panel-collapse collapse" aria-labelledby="contributors"><div class="panel-body"><ul><li><a href="https://twitter.github.io/heron/docs/contributors/community">Community</a></li><li><a href="https://twitter.github.io/heron/docs/contributors/governance">Governance</a></li></ul></div></div></div></div></nav></aside><section class="hn-docs-main col-xs-12 col-sm-12 col-md-8 col-lg-10 col-md-offset-4 col-lg-offset-2"><header class="hn-docs-header page-header"><h1 class="hn-docs-title">Setting up Heron with Aurora Cluster Locally on Linux</h1><div class="hn-docs-description"></div></header><article class="hn-docs-content">

<p>It is possible to setup Heron with a locally running Apache Aurora cluster.
This is a step by step guide on how to configure and setup all the necessary
components.</p>

<h2 id="setting-up-apache-aurora-cluster-locally">Setting Up Apache Aurora Cluster locally</h2>

<p>You first need to setup Apache Aurora locally. More detailed description of the
following steps can be found in <a href="http://aurora.apache.org/documentation/latest/getting-started/vagrant/">A local Cluster with Vagrant</a></p>

<h3 id="step-1-install-virtualbox-and-vagrant">Step 1: Install VirtualBox and Vagrant</h3>

<p>Download and install VirtualBox and Vagrant on your machine. If vagrant is successfully
installed in your machine the following command should list several common commands
for this tool</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span>$ vagrant
</code></pre></div>

<h3 id="step-2-clone-the-aurora-repository">Step 2: Clone the Aurora repository</h3>

<p>You can get the source repository for Aurora with the following command</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span>$ dgit clone git://git.apache.org/aurora.git
</code></pre></div>

<p>Once the clone is complete cd into the aurora folder</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span>$ <span class="nb">cd</span> aurora
</code></pre></div>

<h3 id="step-3-starting-local-aurora-cluster">Step 3: Starting Local Aurora Cluster</h3>

<p>To start the local cluster all you have to do is execute the following command. It will install all the needed dependencies like Apache Mesos and Zookeeper in the VM.</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span>$ vagrant up
</code></pre></div>

<p>Additionally to get rid of some of the warning messages that you get during up command execute the following command</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span>$ vagrant plugin install vagrant-vbguest
</code></pre></div>

<p>You can verify that the Aurora cluster is properly running by opening the following links in your web-browser</p>

<ul>
<li>Scheduler - <a href="http://192.168.33.7:8081">http://192.168.33.7:8081</a></li>
<li>Observer - <a href="http://192.168.33.7:1338">http://192.168.33.7:1338</a></li>
<li>Mesos Master - <a href="http://192.168.33.7:5050">http://192.168.33.7:5050</a></li>
<li>Mesos Agent - <a href="http://192.168.33.7:5051">http://192.168.33.7:5051</a></li>
</ul>

<p>If you go into <a href="http://192.168.33.7:8081/scheduler">http://192.168.33.7:8081/scheduler</a> you can notice that the name of the default cluster that is setup in aurora is
named <code>devcluster</code> this will be important to note when submitting typologies from heron.</p>

<p><img src="https://twitter.github.io/heron/img/aurora-local-cluster-start.png" alt="Heron topology" /></p>

<h2 id="installing-heron-within-vm">Installing Heron within VM</h2>

<p>Now that the Aurora cluster is setup you need to install heron within the cluster VM in order to be able to get the Heron
deployment working. Since this is a fresh VM instance you will have to install the basic software such as &ldquo;unzip&rdquo; and set
the JAVA_HOME path as an environmental variable ( Just need to add this to .bashrc file). After you have the basic stuff
working follow the following steps to install Heron in the VM. You can ssh into the VM with the following command</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span>$ vagrant ssh
</code></pre></div>

<h3 id="step-1-a-download-installation-script-files">Step 1.a : Download installation script files</h3>

<p>You can download the script files that match your Linux distribution from
<a href="https://github.com/twitter/heron/releases/tag/0.16.5">https://github.com/twitter/heron/releases/tag/0.16.5</a></p>

<p>For example for the 0.16.5 release the files you need to download For Ubuntu will be the following.</p>

<ul>
<li><code>heron-client-install-0.16.5-ubuntu.sh</code></li>
<li><code>heron-tools-install-0.16.5-ubuntu.sh</code></li>
</ul>

<p>Optionally - You want need the following for the steps in the blog post</p>

<ul>
<li><code>heron-api-install-0.16.5-ubuntu.sh</code></li>
<li><code>heron-core-0.16.5-ubuntu.tar.gz</code></li>
</ul>

<h3 id="step-1-b-execute-the-client-and-tools-shell-scripts">Step 1.b: Execute the client and tools shell scripts</h3>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span>$ chmod +x heron-client-install-VERSION-PLATFORM.sh
$ ./heron-client-install-VERSION-PLATFORM.sh --user
Heron client installer
----------------------

Uncompressing......
Heron is now installed!

Make sure you have <span class="s2">&quot;/home/vagrant/bin&quot;</span> in your path.
</code></pre></div>

<p>After this you need to add the path &ldquo;/home/vagrant/bin&rdquo;. You can just execute the following command
or add it to the end of  .bashrc file ( which is more convenient ).</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span>$ <span class="nb">export</span> <span class="nv">PATH</span><span class="o">=</span><span class="nv">$PATH</span>:/home/vagrant/bin
</code></pre></div>

<p>Install the following packages to make sure that you have all the needed dependencies in the VM.
You might have to do sudo apt-get update before you execute the following.</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span>$ sudo apt-get install git build-essential automake cmake libtool zip libunwind-setjmp0-dev zlib1g-dev unzip pkg-config -y
</code></pre></div>

<h2 id="configuring-state-manager-apache-zookeeper">Configuring State Manager ( Apache Zookeeper )</h2>

<p>Since Heron only uses Apache Zookeeper for coordination the load on the Zookeeper
node is minimum. Because of this it is sufficient to use a single Zookeeper node or
if you have an Zookeeper instance running for some other task you can simply use that.
Since Apache Aurora already uses an Zookeeper instance you can directly use that instance
to execute State Manager tasks of Heron. First you need to configure Heron to work with
the Zookeeper instance. You can find meanings of each attribute in <a href="../../statemanagers/zookeeper">Setting Up ZooKeeper
State Manager</a>. Configurations for State manager are
located in the directory <code>/home/vagrant/.heron/conf/aurora</code>.</p>

<p>Open the file <code>statemgr.yaml</code> using vim ( or some other text editor you prefer )
and add/edit the file to include the following.</p>
<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span></span><span class="c1"># local state manager class for managing state in a persistent fashion</span>
<span class="l l-Scalar l-Scalar-Plain">heron.class.state.manager</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">com.twitter.heron.statemgr.zookeeper.curator.CuratorStateManager</span>

<span class="c1"># local state manager connection string</span>
<span class="l l-Scalar l-Scalar-Plain">heron.statemgr.connection.string</span><span class="p p-Indicator">:</span>  <span class="s">&quot;127.0.0.1:2181&quot;</span>

<span class="c1"># path of the root address to store the state in a local file system</span>
<span class="l l-Scalar l-Scalar-Plain">heron.statemgr.root.path</span><span class="p p-Indicator">:</span> <span class="s">&quot;/heronroot&quot;</span>

<span class="c1"># create the zookeeper nodes, if they do not exist</span>
<span class="l l-Scalar l-Scalar-Plain">heron.statemgr.zookeeper.is.initialize.tree</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">True</span>

<span class="c1"># timeout in ms to wait before considering zookeeper session is dead</span>
<span class="l l-Scalar l-Scalar-Plain">heron.statemgr.zookeeper.session.timeout.ms</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">30000</span>

<span class="c1"># timeout in ms to wait before considering zookeeper connection is dead</span>
<span class="l l-Scalar l-Scalar-Plain">heron.statemgr.zookeeper.connection.timeout.ms</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">30000</span>

<span class="c1"># timeout in ms to wait before considering zookeeper connection is dead</span>
<span class="l l-Scalar l-Scalar-Plain">heron.statemgr.zookeeper.retry.count</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">10</span>

<span class="c1"># duration of time to wait until the next retry</span>
<span class="l l-Scalar l-Scalar-Plain">heron.statemgr.zookeeper.retry.interval.ms</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">10000</span>
</code></pre></div>

<h2 id="creating-paths-in-zookeeper">Creating Paths in Zookeeper</h2>

<p>Next you need to create some paths within Zookeeper since some of the paths
are not created by Heron automatically. So you need to create them manually.
Since Aurora installation already installed Zookeeper, you can use the Zookeeper
cli to create the manual paths.</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span>$ sudo ./usr/share/zookeeper/bin/zkCli.sh
</code></pre></div>

<p>This will connect to the Zookeeper instance running locally. Then execute the
following commands from within the client to create paths <code>/heronroot/topologies</code>
and <code>/heron/topologies</code>. Later in &ldquo;Associating new Aurora cluster into Heron UI&rdquo;
you will see that you only need to create <code>/heronroot/topologies</code> but for now lets
create both to make sure you don&rsquo;t get any errors when you run things.</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span>create /heronroot null
create /heronroot/topologies null
</code></pre></div>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span>create /heron null
create /heron/topologies null
</code></pre></div>

<h2 id="configuring-scheduler-apache-aurora">Configuring Scheduler ( Apache Aurora )</h2>

<p>Next you need to configure Apache Aurora to be used as the Scheduler for our Heron
local cluster. In order to do this you need to edit the <code>scheduler.yaml</code> file that is
also located in <code>/home/vagrant/.heron/conf/aurora</code>. Add/Edit the file to include the
following. More information regarding parameters can be found in <a href="../aurora">Aurora Cluster</a></p>
<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span></span><span class="c1"># scheduler class for distributing the topology for execution</span>
<span class="l l-Scalar l-Scalar-Plain">heron.class.scheduler</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">com.twitter.heron.scheduler.aurora.AuroraScheduler</span>

<span class="c1"># launcher class for submitting and launching the topology</span>
<span class="l l-Scalar l-Scalar-Plain">heron.class.launcher</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">com.twitter.heron.scheduler.aurora.AuroraLauncher</span>

<span class="c1"># location of the core package</span>
<span class="l l-Scalar l-Scalar-Plain">heron.package.core.uri</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">file:///home/vagrant/.heron/dist/heron-core.tar.gz</span>

<span class="c1"># location of java - pick it up from shell environment</span>
<span class="l l-Scalar l-Scalar-Plain">heron.directory.sandbox.java.home</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">/usr/lib/jvm/java-1.8.0-openjdk-amd64/</span>

<span class="c1"># Invoke the IScheduler as a library directly</span>
<span class="l l-Scalar l-Scalar-Plain">heron.scheduler.is.service</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">False</span>
</code></pre></div>

<p>Additionally edit the <code>client.yaml</code> file and change the core uri to make it consistant.</p>
<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span></span><span class="c1"># location of the core package</span>
<span class="l l-Scalar l-Scalar-Plain">heron.package.core.uri</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">file:///home/vagrant/.heron/dist/heron-core.tar.gz</span>
</code></pre></div>

<h3 id="important-step-change-folder-name-aurora-to-devcluster">Important Step: Change folder name <code>aurora</code> to <code>devcluster</code></h3>

<p>Next you need to change the folder name of <code>/home/vagrant/.heron/conf/aurora</code> to
<code>/home/vagrant/.heron/conf/devcluster</code>. This is because the name of your aurora
cluster is <code>devcluster</code> as you noted in a previous step. You can do this with the
following commands</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span>$ <span class="nb">cd</span> /home/vagrant/.heron/conf/
$ mv aurora devcluster
</code></pre></div>

<h2 id="submitting-example-topology-to-aurora-cluster">Submitting Example Topology to Aurora cluster</h2>

<p>Now you can submit a topology to the aurora cluster. this can be done with the following command.</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span>$ heron submit devcluster/heronuser/devel --config-path ~/.heron/conf/ ~/.heron/examples/heron-examples.jar com.twitter.heron.examples.ExclamationTopology ExclamationTopology
</code></pre></div>

<p>Now you should be able to see the topology in the Aurora UI ( <a href="http://192.168.33.7:8081/scheduler/heronuser">http://192.168.33.7:8081/scheduler/heronuser</a> ) .</p>

<p><img src="https://twitter.github.io/heron/img/aurora-local-topology-submitted.png" alt="Heron topology" /></p>

<h3 id="understanding-the-parameters">Understanding the parameters</h3>

<p>below is a brief explanation on some of the important parameters that are used in this command. the first
parameter <code>devcluster/heronuser/devel</code> defines cluster, role and env ( env can have values <code>prod | devel | test | staging</code> ).
The cluster is the name of the aurora cluster which is <code>devcluster</code> in our case. You can give something like your
name for the role name and for env you need to choose from one of the env values.</p>

<p><code>--config-path</code> points to the config folder. the program will automatically look for a folder with the cluster name.
This is why you had to change the name of the aurora conf folder to devcluster.</p>

<p>Now that everything is working you need to perform one last step to be able to see the typologies that you can see in Aurora UI in Heron UI.</p>

<h2 id="associating-new-aurora-cluster-into-heron-ui">Associating new Aurora cluster into Heron UI</h2>

<p>Heron UI uses information that is gets from the heron tracker when displaying the information in the heron UI interface.
So in-order to allow the Heron UI to show Aurora cluster information you need to modify configuration of the Heron tracker
so that it can identify the Aurora Cluster.</p>

<p>Heron Tracker configurations are located at <code>/home/vagrant/.herontools/conf</code> the configuration file is named <code>heron_tracker.yaml</code>.
By default you should see the following in the file</p>
<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span></span><span class="l l-Scalar l-Scalar-Plain">statemgrs</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span>
    <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="s">&quot;file&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="s">&quot;local&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">rootpath</span><span class="p p-Indicator">:</span> <span class="s">&quot;~/.herondata/repository/state/local&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">tunnelhost</span><span class="p p-Indicator">:</span> <span class="s">&quot;localhost&quot;</span>
  <span class="p p-Indicator">-</span>
    <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="s">&quot;zookeeper&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="s">&quot;localzk&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">hostport</span><span class="p p-Indicator">:</span> <span class="s">&quot;localhost:2181&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">rootpath</span><span class="p p-Indicator">:</span> <span class="s">&quot;/heron&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">tunnelhost</span><span class="p p-Indicator">:</span> <span class="s">&quot;localhost&quot;</span>
</code></pre></div>

<p>You can see that there already two entries. Before, you had to create paths in Zookeeper for <code>/heron/topologies</code> this is
because the entry named <code>localzk</code> in this file. If you remove this you will not need to create that path in Zookeeper.
Now all you have to is to add a new entry for the aurora cluster into this file ( lets comment out <code>localzk</code> ).
Then the file would look like below.</p>
<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span></span><span class="l l-Scalar l-Scalar-Plain">statemgrs</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span>
    <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="s">&quot;file&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="s">&quot;local&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">rootpath</span><span class="p p-Indicator">:</span> <span class="s">&quot;~/.herondata/repository/state/local&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">tunnelhost</span><span class="p p-Indicator">:</span> <span class="s">&quot;localhost&quot;</span>
  <span class="c1">#-</span>
   <span class="c1">#type: &quot;zookeeper&quot;</span>
   <span class="c1"># name: &quot;localzk&quot;</span>
   <span class="c1"># hostport: &quot;localhost:2181&quot;</span>
   <span class="c1"># rootpath: &quot;/heron&quot;</span>
   <span class="c1"># tunnelhost: &quot;localhost&quot;</span>
  <span class="p p-Indicator">-</span>
    <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="s">&quot;zookeeper&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="s">&quot;devcluster&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">hostport</span><span class="p p-Indicator">:</span> <span class="s">&quot;localhost:2181&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">rootpath</span><span class="p p-Indicator">:</span> <span class="s">&quot;/heronroot&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">tunnelhost</span><span class="p p-Indicator">:</span> <span class="s">&quot;localhost&quot;</span>
</code></pre></div>

<p>Now you can start Heron tracker and then Heron UI, Now you will be able to see the aurora cluster from the
Heron UI ( <a href="http://192.168.33.7:8889/topologies">http://192.168.33.7:8889/topologies</a> ) as below</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span>$ heron-tracker
$ heron-ui
</code></pre></div>

<p><img src="https://twitter.github.io/heron/img/heron-ui-topology-submitted.png" alt="Heron topology" /></p>
</article></section></div></div></div></main><script src="https://code.jquery.com/jquery-2.2.1.min.js"></script><script src="https://twitter.github.io/heron/js/app.min.js"></script><script type="text/javascript">
$('pre code').each(function() {
  console.log(this);
  this.innerHTML = this.innerHTML.replace(/\$\s/g, function(matched) {
    return `<span class=\"clp\">${matched}</span>`;
  });
});
</script></body></html>